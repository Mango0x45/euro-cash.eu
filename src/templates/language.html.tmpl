{{ define "header" }}
<style>
	*:has(> .lang-fade-in-out) {
		line-height: 1.1;
	}

	.lang-fade-in-out {
		opacity: 0.5;
		transition: opacity 1s;

		&.hide {
			opacity: 0;
		}
	}
</style>

<script>
	(() => {
		let i = 0;
		let nodes;
		const Δt = 5000; /* Total time a text is shown */
		const Δf = 1000; /* Fade duration */
		const texts = [
			// ["en", "Select Your Language",    "Eurozone Languages",  "Other Languages"],
			["nl", "Kies uw taal",            "Eurozone talen",      "Andere talen"],
			["sv", "Välj ditt språk",         "Eurozonens språk",    "Andra språk"],
			["fi", "Valitse kieli",           "Euroalueen kielet",   "Muut kielet"],
			["de", "Wählen Sie Ihre Sprache", "Eurozone Sprachen",   "Weitere Sprachen"],
			["el", "Επιλέξτε τη γλώσσα σας",  "Γλώσσες Ευρωζώνης",   "Άλλες γλώσσες"],
			["bg", "Изберете език",           "Езици на еврозоната", "Други езици"],
		];

		const updateTexts = () => {
			nodes.forEach((n, j) => {
				const [lang, ...strs] = texts[i];
				n.lang = lang;
				n.textContent = strs[j];
				n.classList.remove("hide");
			});
		};

		const change = () => {
			nodes.forEach(n => n.classList.add("hide"));
			setTimeout(() => {
				i = (i + 1) % texts.length;
				updateTexts();
			}, Δf);
		};

		document.addEventListener("DOMContentLoaded", _ => {
			nodes = $$('.lang-fade-in-out');
			updateTexts();
			/* When you first do a page load there is no fade-in for the initial
			   text, so we want to trigger a fade-out Δf milliseconds earlier */
			setTimeout(() => {
				change();
				setInterval(change, Δt);
			}, Δt - Δf);
		});
	})();
</script>
{{ end }}

{{ define "content" }}
<header>
	{{ template "navbar" . }}
	<h1>
		{{ .Get "Select Your Language" }}
		<br><span class="lang-fade-in-out"></span>
	</h1>
</header>
<main>
	<h2>
		{{ .Get "Eurozone Languages" }}
		<br><span class="lang-fade-in-out"></span>
	</h2>
	{{ template "langgrid" true }}
	<h2>
		{{ .Get "Other Languages" }}
		<br><span class="lang-fade-in-out"></span>
	</h2>
	{{ template "langgrid" false }}
</main>
{{ end }}

{{ define "langgrid" }}
{{ $ez := . }}
<form action="/language" method="POST">
	<div class="lang-grid">
		{{ range locales }}
			{{ if eq $ez .Eurozone }}
				<button
					type="submit"
					name="locale"
					value={{ .Bcp }}
					{{ if not .Enabled }}
						disabled
					{{ end }}
				>
					<span
						lang={{ .Bcp }}
						data-code={{ .Language | toUpper }}
					>
						{{ .Name }}
					</span>
				</button>
			{{ end }}
		{{ end }}
	</div>
</form>
{{ end }}